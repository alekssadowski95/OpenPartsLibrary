<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Title -->
    {% if title %}
        <title>{{ title }} | OpenPartsLibrary</title>
    {% else %}
        <title>OpenPartsLibrary</title>
    {% endif %}

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-5.3.3-dist/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-icons-1.11.3/font/bootstrap-icons.min.css') }}">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="48x48" href="{{ url_for('static', filename='nut-bolt.png') }}">

    <!-- Custom styles -->
    <style>
    .btn-link-transparent:hover {
        background-color: rgba(0, 0, 0, 0.136);
        outline: 1px;
    }
    
    .btn-link-transparent:hover:active {
        background-color: rgba(0, 0, 0, 0.421);
        outline: 1px;
    }

    .input-search-header {
        color: rgb(15, 62, 124) !important;
    }

    .input-search-header:focus {
        background-color: white !important;
        color: rgb(0, 0, 0) !important;
    }

    .input-search-header:focus::placeholder {
        color: rgb(15, 62, 124) !important;
        opacity: 1; /* Firefox */
    }

    .input-search-header:focus::-ms-input-placeholder { /* Edge 12 -18 */
        color: rgb(189, 189, 189) !important;
    }

    .input-search-header::placeholder {
        color: rgb(15, 62, 124);
        opacity: 1; /* Firefox */
    }

    .input-search-header::-ms-input-placeholder { /* Edge 12 -18 */
        color: rgb(15, 62, 124);
    }

    .sidebar-nav ul li {
        padding-top: 10px;
        padding-bottom: 10px;
    }

    .sidebar-nav ul li a span{
        font-size: 0.70rem;
    }

    .sidebar-nav ul li:hover {
        background-color: rgba(0, 0, 0, 0.4);
        cursor: pointer;
    }

    .overlay {
        position: absolute;
        top: 0;
        right: -400px;
        width: 400px;
        height: 100%;
        background-color: rgb(1, 29, 65);
        z-index: 20; 
        display: block;
        transition: display 4s allow-discrete;
    }
    </style>
    {% block style %}{% endblock style %}
</head>
<body style="min-width: 100%; min-height: 100%; max-width: 100%; max-height: 100%; margin: 0; padding: 0; overflow: hidden;">
    <!-- Header -->
    <div class="row mx-0" style="height: 52px; background-color: #042c61; ">
        <header style="padding-left: 10px; padding-right: 6px; border-bottom: 1px solid #042c61;" class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between" >
            <!-- Application logo and name -->
            <div class="col-md-3 mb-2 mb-md-0" title="Go to home">
                <a href="{{ url_for('home') }}" class="d-inline-flex link-body-emphasis text-decoration-none">
                    <img src="{{ url_for('static', filename='nut-bolt.png') }}" role="img" aria-label="Bootstrap" height="36px" style="padding-right: 6px; margin-top: 8px; filter: brightness(0.5)"><use xlink:href="#bootstrap"></use></img>
                    <span style="color: rgb(255, 255, 255); text-decoration: none; padding-top: 12px; padding-bottom: 12px; font-size: 18px;">OpenPartsLibrary</span>
                </a>
            </div>
            <!-- Search form -->
            <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
                <form id="search-form" role="search">
                    <input title="Search for a component by its name or description" name="search_query" type="search" style="width: 380px; height: 36px; background-color: rgb(1, 29, 65); border-color: #0a3b7a;" class="form-control input-search-header" placeholder="Search..." value="{{ search_query }}" id="site-search" aria-label="Search">
                </form>
            </ul>
            <!-- Right side alighed elements -->
            <div class="col-md-3 text-end">
                {% if user and user.is_authenticated %}
                    <a title="Open and close the components bucket" style="text-decoration: none;" class="btn btn-link p-1 btn-link-transparent" href="{{ url_for('profile') }}">
                        <span style="color: white;">{{ user.username }}</span>
                        <img src="{{ url_for('static', filename='bootstrap-icons-1.11.3/person-circle.svg') }}" alt="" style="padding: 0;" height="28px" width="28px">
                    </a>
                {% else %}
                <a title="Open and close the components bucket" style="text-decoration: none;" class="btn btn-link p-1 btn-link-transparent" href="{{ url_for('login') }}">
                    <span style="color: white; ">Login</span>
                    <img src="{{ url_for('static', filename='bootstrap-icons-1.11.3/person-circle.svg') }}" alt="" style="padding: 0;" height="28px" width="28px">
                </a>
                {% endif %}
                <button title="Open and close the components bucket" class="btn btn-link p-1 btn-link-transparent">
                    <img src="{{ url_for('static', filename='assembly-line.png') }}" alt="" style="padding: 0;" height="28px" width="28px" onclick="showPartsBucket()">
                </button>
            </div>
        </header>
      </div>
    </div>
    <!-- Main view and sidebars -->
    <div class="row p-0 m-0" style="min-height: calc(100vh - 79px); max-height: calc(100vh - 79px);">
        <!-- Sidebar left-->
        <div class="col" style="overflow-y: auto; overflow-x: hidden; min-height: calc(100vh - 79px); max-height: calc(100vh - 79px); min-width: 80px; max-width: 80px; width: 80px; background-color: #042c61; border: none; padding: 0; border-right: 1px solid lightgray;">
            <nav class="sidebar-nav" style="width: 100%;">
                <ul class="px-0" style="list-style: none; margin: 0; margin-top: 16px; margin-bottom: 16px; width: 100%;">
                    <!-- Components button -->
                    <li>
                        <a title="Browse all components" href="{{ url_for('components') }}" class="text-muted p-0 m-0 w-100 d-flex flex-column align-items-center justify-content-center">
                            <img src="{{ url_for('static', filename='menu-white.png') }}" style="height: 18px; width: 18px;" alt=""></img>
                            <span style="color: white;">Components</span>
                        </a>
                    </li>
                    <!-- Materials button 
                    <li>
                        <a title="Browse all materials" href="{{ url_for('materials') }}" class="text-muted p-0 m-0 w-100 d-flex flex-column align-items-center justify-content-center">
                            <img src="{{ url_for('static', filename='material.png') }}" style="height: 20px; width: 20px;" alt=""></img>
                            <span style="color: white;">Materials</span>
                        </a>
                    </li>
                    -->
                    <!-- Suppliers button -->
                    <li>
                        <a title="Browse all suppliers" href="{{ url_for('suppliers') }}" class="text-muted p-0 m-0 w-100 d-flex flex-column align-items-center justify-content-center">
                            <img src="{{ url_for('static', filename='supplier.png') }}" style="height: 26px; width: 26px;" alt=""></img>
                            <span style="color: white;">Suppliers</span>
                        </a>
                    </li>
                    <!-- Settings button -->
                    <li>
                        <a title="Application settings" href="{{ url_for('settings') }}" class="text-muted p-0 m-0 w-100 d-flex flex-column align-items-center justify-content-center">
                            <img src="{{ url_for('static', filename='settings.png') }}" style="height: 20px; width: 20px;" alt=""></img>
                            <span style="color: white;">Settings</span>
                        </a>
                        
                    </li>
                </ul> 
            </nav>
        </div>
        <!-- Main view -->
        <main class="col p-0" style="position: relative; min-height: calc(100vh - 79px); max-height: calc(100vh - 79px); height: calc(100vh - 79px); width: calc(100vw - 99px); background-color: #f8f9fa;">
            {% block main_view %}{% endblock main_view %}
            <!-- New assembly sidebar -->
            <div id="parts-bucket-div" class="overlay" style="color: white;">
                <div class="container-fluid" style="height: 40px; border-bottom: 1px solid #042c61; padding-top: 6px;">
                    <span>New component assembly</span>
                    <a id="clear-parts-bucket-button" type="button" class="btn btn-outline-light btn-sm" style="font-size: smaller;" onclick="clearSessionList('partsBucketList')">
                        <img src="{{ url_for('static', filename = 'bootstrap-icons-1.11.3/trash.svg') }}" width="18" height="18" style="color: white;">Clear
                    </a>
                </div>
                <ul id="parts-bucket-list" class="p-2 pb-0 m-0" style="height: calc(100% - 102px); overflow-y: scroll;">
                </ul>
                <div class="container-fluid" style="height: 60px; border-top: 1px solid #042c61; padding-top: 12px;">
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" type="button">Create assembly</button>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- Bottom bar -->
    <div style="min-height: 27px; max-height: 27px; margin: 0px; background-color:#042c61; color: white; ">
        <span style="font-size: 11px; margin: 0px; padding-left: 8px;">
            <span>Copyright (C) 2024 - 2025. OpenPartsLibrary by </span>
            <a style="color: white; " href="https://www.alsado.de">www.alsado.de</a>
        </span>
    </div>
    <!-- Scripts -->
    <script>
        const partsBucketDiv = document.getElementById("parts-bucket-div");
        const partsBucketList = document.getElementById("parts-bucket-list");

        function updatePartsBucketContent() {
            let cardsHTML = buildCardsFromSession("partsBucketList");

            // Insert into a container element on the page
            document.getElementById("parts-bucket-list").innerHTML = cardsHTML;
        }

        function showPartsBucket() {
            updatePartsBucketContent();

            if (partsBucketDiv.style.right == "0px") {
                partsBucketDiv.style.right = "-400px";
            } else {
                partsBucketDiv.style.right = "0px";
            }
        }

        // Function to clear the list in sessionStorage
        function clearSessionList(key) {
            sessionStorage.removeItem(key);
            updatePartsBucketContent();
        }

        // Function to build Bootstrap card HTML from list in sessionStorage
        function buildCardsFromSession(key) {
            // Get list from sessionStorage
            let list = JSON.parse(sessionStorage.getItem(key)) || [];

            // Start with empty HTML string
            let html = "";

            // Loop through each item and build a Bootstrap card
            list.forEach(item => {
                html += `
                <div class="card mb-2" style="background-color: #042c61; color: white; border-color: #0a3b7a;">
                    <div class="card-body">
                    <p class="card-text">${item}</p>
                    </div>
                </div>
                `;
            });

            return html;
        }

        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("search-form");

            form.addEventListener("submit", function (event) {
                event.preventDefault(); // stop page reload

                // Find the input by its name attribute
                const queryInput = form.querySelector('[name="search_query"]');
                const value = queryInput.value.trim();

                if (value) {
                    window.location.href = "{{ url_for('components') }}?search_query=" + value;
                }
            });
        });


    </script>
    <script src="{{ url_for('static', filename='bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js') }}"></script>
    {% block script %}{% endblock script %}
</body>
</html>